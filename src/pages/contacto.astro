---
import Layout from "../layouts/Layout.astro";
import Header from "../components/sections/Nosotros/Header.astro";
---

<!-- ---
import Header from "../components/sections/Nosotros/Header.astro";
import Layout from "../layouts/Layout.astro";
---

<Layout>
    <Header />

    <section
        class="max-w-7xl mx-auto items-center grid grid-cols-1 lg:grid-cols-2 justify-between px-4 lg:px-0 py-4"
    >
        <div class="flex flex-col w-full gap-8">
            <input
                type="text"
                class="border w-full rounded-lg border-[#051314] px-4 py-2 text-lg"
                placeholder="Nombre"
            />
            <input
                type="text"
                class="border w-full rounded-lg border-[#051314] px-4 py-2 text-lg"
                placeholder="Apellido"
            />
            <input
                type="text"
                class="border w-full rounded-lg border-[#051314] px-4 py-2 text-lg"
                placeholder="Telefono"
            />
            <input
                type="text"
                class="border w-full rounded-lg border-[#051314] px-4 py-2 text-lg"
                placeholder="E-mail"
            />

            <textarea
                name=""
                class="border w-full rounded-lg border-[#051314] px-4 py-2 text-lg"
                placeholder="Mensaje..."
                id=""></textarea>

            <button
                class="bg-[#666695] text-[#EFE8E6] p-2 rounded-lg w-full lg:w-1/2 text-lg"
                >Enviar</button
            >
        </div>

        <div class="flex items-center justify-center flex-col">
            <h2 class="text-[#051314] font-semibold text-3xl">
                Hablemos de tu próximo <br /> proyecto
            </h2>
        </div>
    </section>
</Layout> -->
<Layout>
    <Header />

    <section
        class="max-w-7xl mx-auto items-center grid grid-cols-1 lg:grid-cols-2 justify-between gap-16 px-4 lg:px-0 py-12 lg:py-24"
    >
        <!-- Contact Form Column -->
        <!-- The main div is now a <form> tag to handle submission -->
        <form id="contact-form" class="flex flex-col w-full gap-8">
            <input
                type="text"
                id="nombre"
                name="nombre"
                class="border w-full rounded-lg border-[#051314] px-4 py-2 text-lg transition-colors focus:border-[#666695] focus:outline-none focus:ring-2 focus:ring-[#666695]/50"
                placeholder="Nombre"
                required
            />
            <input
                type="text"
                id="apellido"
                name="apellido"
                class="border w-full rounded-lg border-[#051314] px-4 py-2 text-lg transition-colors focus:border-[#666695] focus:outline-none focus:ring-2 focus:ring-[#666695]/50"
                placeholder="Apellido"
                required
            />
            <input
                type="tel"
                id="telefono"
                name="telefono"
                class="border w-full rounded-lg border-[#051314] px-4 py-2 text-lg transition-colors focus:border-[#666695] focus:outline-none focus:ring-2 focus:ring-[#666695]/50"
                placeholder="Teléfono"
                required
            />
            <input
                type="email"
                id="email"
                name="email"
                class="border w-full rounded-lg border-[#051314] px-4 py-2 text-lg transition-colors focus:border-[#666695] focus:outline-none focus:ring-2 focus:ring-[#666695]/50"
                placeholder="E-mail"
                required
            />
            <textarea
                name="mensaje"
                id="mensaje"
                class="border w-full rounded-lg border-[#051314] px-4 py-2 text-lg transition-colors focus:border-[#666695] focus:outline-none focus:ring-2 focus:ring-[#666695]/50 h-32 resize-none"
                placeholder="Mensaje..."
                required></textarea>
            <button
                type="submit"
                id="submit-button"
                class="bg-[#666695] text-[#EFE8E6] p-2 rounded-lg w-full lg:w-1/2 text-lg transition-all duration-300 ease-in-out hover:bg-[#55557e] disabled:bg-[#3A411D] disabled:cursor-not-allowed"
            >
                Enviar
            </button>
        </form>

        <!-- Text Column -->
        <div class="flex items-start justify-center flex-col">
            <h2 class="text-[#051314] font-semibold text-4xl">
                Hablemos de tu próximo <br /> proyecto
            </h2>
            <img src="/contactp.png" alt="Contacto" class="w-full" />
        </div>
    </section>
</Layout>

<script>
    // This script runs on the client to handle form interactions.
    const contactForm = document.getElementById(
        "contact-form",
    ) as HTMLFormElement;
    const submitButton = document.getElementById(
        "submit-button",
    ) as HTMLButtonElement;

    // Reemplazá estos con los tuyos
    // Obtenelos desde el panel del formulario en HubSpot

    const HUBSPOT_PORTAL_ID = "50272950";
    const HUBSPOT_FORM_ID = "980d41bf-27cb-4c5a-b1d9-23b0ab7af66f";

    // --- Form Validation ---
    const validateForm = (): boolean => {
        let isValid = true;
        // Select all inputs and the textarea that have the 'required' attribute.
        const requiredFields = contactForm.querySelectorAll<
            HTMLInputElement | HTMLTextAreaElement
        >("[required]");

        requiredFields.forEach((field) => {
            // Reset to original border color on each validation attempt.
            field.classList.remove("border-red-500");
            field.classList.add("border-[#051314]");

            // Check if the field is empty.
            if (!field.value.trim()) {
                isValid = false;
                field.classList.add("border-red-500");
                field.classList.remove("border-[#051314]");
            }

            // Perform a specific format check for the email field.
            if (field.type === "email") {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(field.value)) {
                    isValid = false;
                    field.classList.add("border-red-500");
                    field.classList.remove("border-[#051314]");
                }
            }
        });

        return isValid;
    };

    // --- Placeholder Submission Function ---
    // This function runs when the form is successfully validated.
    const handleFormSubmit = async () => {
        submitButton.disabled = true;
        submitButton.innerText = "Enviando...";

        const formData = new FormData(contactForm);

        // Adaptar los campos según lo que espera HubSpot
        const data = {
            fields: [
                { name: "firstname", value: formData.get("nombre") },
                { name: "lastname", value: formData.get("apellido") },
                { name: "telefono", value: formData.get("telefono") },
                { name: "email", value: formData.get("email") },
                { name: "mensaje", value: formData.get("mensaje") },
            ],
            context: {
                pageUri: window.location.href,
                pageName: document.title,
            },
        };

        try {
            const response = await fetch(
                `https://api.hsforms.com/submissions/v3/integration/submit/${HUBSPOT_PORTAL_ID}/${HUBSPOT_FORM_ID}`,
                {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(data),
                },
            );

            if (response.ok) {
                submitButton.innerHTML =
                    "¡Mensaje enviado correctamente!<br>Te responderemos a la brevedad.";
                submitButton.classList.remove("lg:w-1/2");
                submitButton.classList.add("w-full");
                contactForm.reset();
            } else {
                throw new Error("HubSpot API Error");
            }
        } catch (err) {
            submitButton.innerText = "Hubo un error. Intentá de nuevo.";
            submitButton.disabled = false;
            console.error(err);
        }
    };

    // --- Event Listener ---
    // Listen for the 'submit' event on the form.
    contactForm.addEventListener("submit", (event: SubmitEvent) => {
        // Prevent the browser's default action of reloading the page.
        event.preventDefault();

        // Run the validation function.
        if (validateForm()) {
            // If validation passes, call the submission handler.
            handleFormSubmit();
        } else {
            // If validation fails, log a message to the console.
            console.log(
                "Form validation failed. Please fill out all required fields correctly.",
            );
        }
    });
</script>
